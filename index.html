<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>ë¯¸ê¶ ì†ì˜ í‹°íƒ€ì„</title>
  <link rel="icon" href="./assets/favicon.ico" />
  <link rel="preload" href="https://cdn.jsdelivr.net/korean-webfonts/1/corps/hani/Hankc/Hankc.woff2" as="font" type="font/woff2" crossorigin />
  <link rel="stylesheet" href="./src/styles.css" />
  <script type="module" src="./src/main.js" defer></script>
</head>
<body>
  <div id="wrap">
    <!-- ì›°ì»´ ë°°ë„ˆ í™”ë©´ -->
    <section id="welcome-banner">
      <div class="banner-content">
        <h1>ë¯¸ê¶ ì†ì˜ í‹°íƒ€ì„</h1>
        <div class="story-text">
          <p>ê¹¼ì–´ìš”? ì—¬ê¸´ í•˜ì´ë“œë¡œ í˜¸í…”.<br>ë³€ë‘ë¦¬ê¸´ í•´ë„ ì‰¬ê¸°ì—” ê·¸ë§Œì´ì£ .</p>
        </div>
        <div class="banner-controls">
          <div class="difficulty-selection">
            <label>ë‚œì´ë„
              <select id="banner-difficulty">
                <option value="easy">ì´ˆê¸‰</option>
                <option value="normal" selected>ì¤‘ê¸‰</option>
                <option value="hard">ìƒê¸‰</option>
              </select>
            </label>
          </div>
          <button id="btn-start" class="primary">ê²Œì„ ì‹œì‘</button>
          <div class="control-instruction">
            <span class="pill"><span class="dot"></span> í‚¤ë³´ë“œ <span class="kbd">WASD</span> ë˜ëŠ” íŒ¨ë“œ</span>
          </div>
        </div>
      </div>
    </section>

    <!-- ê²Œì„ í™”ë©´ (ì²˜ìŒì—” ìˆ¨ê²¨ì§) -->
    <div id="game-container" style="display: none;">
      <div class="hud">
        <div class="pill" id="hud-left">ì‹œê°„: <b id="hud-time">0.0</b>s Â· ìŠ¤í…: <b id="hud-steps">0</b> Â· ì½”ì¸: <b id="hud-coins">0</b></div>
        <div class="right">
          <div class="pill">ì˜ˆìƒì ìˆ˜: <b id="hud-score">0</b></div>
          <div class="pill">ìµœê³ ì : <b id="hud-best">0</b></div>
          <button id="btn-mute" class="pill mute-button" title="ìŒì†Œê±° í† ê¸€">ğŸ”Š</button>
          <div class="pill" id="hud-effects" style="display:none"></div>
        </div>
      </div>
      
      <main id="game">
        <canvas id="cv" width="960" height="960"></canvas>
        <section id="result">
          <div class="card">
            <h2 id="res-title">ê²°ê³¼</h2>
            <table>
              <tbody id="res-body"></tbody>
              <tfoot>
                <tr><td class="total">ì´ì </td><td class="total" id="res-total"></td></tr>
              </tfoot>
            </table>
            <div class="row">
              <button id="btn-retry">ë‹¤ì‹œ í•˜ê¸°</button>
              <button id="btn-continue">ë‚œì´ë„ ìœ ì§€ Â· ìƒˆ ë¯¸ë¡œ</button>
            </div>
          </div>
        </section>
      </main>

      <div id="bottom-controls">
        <div id="controls-left">
          <div id="pad" aria-label="direction pad">
            <div></div><button data-dir="up">â–²</button><div></div>
            <button data-dir="left">â—€</button><div></div><button data-dir="right">â–¶</button>
            <div></div><button data-dir="down">â–¼</button><div></div>
          </div>
        </div>
        <div id="controls-right">
          <div class="control-row">
            <button id="btn-home" class="secondary">ì²˜ìŒìœ¼ë¡œ</button>
            <button id="btn-new" class="primary">ìƒˆ ê²Œì„</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- BGM ì˜¤ë””ì˜¤ ìš”ì†Œ -->
  <audio id="bgm" loop>
    <source src="./assets/bgm.mp3" type="audio/mp3">
  </audio>

  <!-- ê°„ë‹¨í•œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ë¡œ ê²Œì„ ì‹œì‘ ê¸°ëŠ¥ ì¶”ê°€ -->
  <script>
    // BGM ê´€ë ¨ ë³€ìˆ˜
    let isMuted = false;
    const bgm = document.getElementById('bgm');
    
    // í˜„ì¬ ë‚œì´ë„ ì €ì¥
    window.currentDifficulty = 'normal';
    
    function startGame() {
      console.log('ê²Œì„ ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œë¨');
      
      // ë°°ë„ˆ ìˆ¨ê¸°ê³  ê²Œì„ í™”ë©´ ë³´ì´ê¸°
      document.getElementById('welcome-banner').style.display = 'none';
      document.getElementById('game-container').style.display = 'block';
      
      // BGM ì‹œì‘
      playBGM();
      
      // ì„ íƒí•œ ë‚œì´ë„ë¡œ ê²Œì„ ì‹œì‘
      const selectedDifficulty = document.getElementById('banner-difficulty').value;
      window.currentDifficulty = selectedDifficulty; // í˜„ì¬ ë‚œì´ë„ ì €ì¥
      
      console.log('ì„ íƒëœ ë‚œì´ë„:', selectedDifficulty);
      
      // ëª¨ë“ˆì—ì„œ ê²Œì„ ì‹œì‘ í•¨ìˆ˜ í˜¸ì¶œ
      if (window.moduleStartGame) {
        window.moduleStartGame(selectedDifficulty);
      }
    }
    
    function playBGM() {
      if (!isMuted && bgm) {
        bgm.volume = 0.3; // ë³¼ë¥¨ 30%ë¡œ ì„¤ì •
        bgm.play().catch(e => console.log('BGM ì¬ìƒ ì‹¤íŒ¨:', e));
      }
    }
    
    function stopBGM() {
      if (bgm) {
        bgm.pause();
        bgm.currentTime = 0;
      }
    }
    
    function toggleMute() {
      isMuted = !isMuted;
      const muteButton = document.getElementById('btn-mute');
      
      if (isMuted) {
        bgm.pause();
        muteButton.textContent = 'ğŸ”‡';
        muteButton.title = 'ìŒì†Œê±° í•´ì œ';
      } else {
        playBGM();
        muteButton.textContent = 'ğŸ”Š';
        muteButton.title = 'ìŒì†Œê±°';
      }
    }
    
    function goHome() {
      console.log('ì²˜ìŒìœ¼ë¡œ ë²„íŠ¼ í´ë¦­ë¨');
      
      // ê²Œì„ í™”ë©´ ìˆ¨ê¸°ê³  ë°°ë„ˆ ë³´ì´ê¸°
      document.getElementById('game-container').style.display = 'none';
      document.getElementById('welcome-banner').style.display = 'flex';
      
      // BGM ì •ì§€
      stopBGM();
      
      // ê²°ê³¼ í™”ë©´ë„ ìˆ¨ê¸°ê¸°
      const resultScreen = document.getElementById('result');
      if (resultScreen) {
        resultScreen.style.display = 'none';
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ í›„ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
    document.addEventListener('DOMContentLoaded', function() {
      const startButton = document.getElementById('btn-start');
      if (startButton) {
        startButton.onclick = startGame;
        console.log('ê²Œì„ ì‹œì‘ ë²„íŠ¼ ì—°ê²°ë¨');
      } else {
        console.error('ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
      }
      
      const homeButton = document.getElementById('btn-home');
      if (homeButton) {
        homeButton.onclick = goHome;
        console.log('ì²˜ìŒìœ¼ë¡œ ë²„íŠ¼ ì—°ê²°ë¨');
      }
      
      const muteButton = document.getElementById('btn-mute');
      if (muteButton) {
        muteButton.onclick = toggleMute;
        console.log('ìŒì†Œê±° ë²„íŠ¼ ì—°ê²°ë¨');
      }
      
      const newButton = document.getElementById('btn-new');
      if (newButton) {
        newButton.onclick = function() {
          console.log('ìƒˆ ê²Œì„ ë²„íŠ¼ í´ë¦­ë¨ (HTML)');
          if (window.moduleStartGame && window.currentDifficulty) {
            window.moduleStartGame(window.currentDifficulty);
          }
        };
        console.log('ìƒˆ ê²Œì„ ë²„íŠ¼ ì—°ê²°ë¨');
      }
    });
  </script>
</body>
</html>
